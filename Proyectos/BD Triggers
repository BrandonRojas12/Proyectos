CREATE DATABASE BDEJ_PARA_TRIG
GO
USE BDEJ_PARA_TRIG
GO

CREATE TABLE CUENTA	(
NO_RENG_PELICULAS 	INT		NULL,
NO_RENG_VOLUMENES 	INT		NULL,
NO_RENG_PROVEEDORES	INT		NULL			)

CREATE TABLE PELICULA	(
ID_ESPECIFICO 	VARCHAR(4)	NOT NULL PRIMARY KEY,
TITULO		VARCHAR(40)	NOT NULL,
CATEGORIA		VARCHAR(30)	NOT NULL			)

CREATE TABLE PROVEEDOR	(
NOMBRE_PROVEEDOR 	VARCHAR(40)	NOT NULL PRIMARY KEY,
TEL_PROVEEDOR	VARCHAR(13)	NULL		)

CREATE TABLE VOLUMEN	(
NO_VOLUMEN 		VARCHAR(4)	NOT NULL PRIMARY KEY,
ID_ESPECIFICO	VARCHAR(4)	NULL 	 FOREIGN KEY (ID_ESPECIFICO)REFERENCES PELICULA(ID_ESPECIFICO)
 	ON UPDATE CASCADE,
NOMBRE_PROVEEDOR 	VARCHAR(40)	NOT NULL	 FOREIGN KEY (NOMBRE_PROVEEDOR)REFERENCES PROVEEDOR(NOMBRE_PROVEEDOR) 
ON UPDATE CASCADE)
			
INSERT INTO PELICULA
(ID_ESPECIFICO, TITULO, CATEGORIA)
VALUES	('1','LOS APROBADOS','C. FICCION'),
	('2','LOS REPROBADOS','DRAMA'),
	('3','LOS FUERA DE R.','SUSPENSO'),
	('4','LOS RECIEN INGRESO','COMEDIA')

INSERT INTO PROVEEDOR
(NOMBRE_PROVEEDOR, TEL_PROVEEDOR)
VALUES	('PELICULAS SA',NULL),
	('PELICULAS PATITO','55'),
	('PELICULAS FUTURO','66')

INSERT INTO VOLUMEN	
(NO_VOLUMEN, ID_ESPECIFICO, NOMBRE_PROVEEDOR)		
VALUES	('001','1','PELICULAS SA'),
	('002','3','PELICULAS PATITO'),
	('005',NULL,'PELICULAS PATITO'),
	('006','1','PELICULAS PATITO'),
	('007',NULL,'PELICULAS FUTURO')

INSERT INTO CUENTA
(NO_RENG_PELICULAS, NO_RENG_VOLUMENES, NO_RENG_PROVEEDORES)
VALUES	(NULL,NULL,NULL)

CREATE TRIGGER TR_UNO 
ON PELICULA
FOR INSERT
AS
UPDATE CUENTA
SET NO_RENG_PELICULAS = (SELECT COUNT(ID_ESPECIFICO)FROM PELICULA) 

CREATE TRIGGER TR_DOS
ON VOLUMEN
FOR INSERT
AS
UPDATE CUENTA
SET NO_RENG_VOLUMENES = (SELECT COUNT(NO_VOLUMEN) FROM VOLUMEN)

SELECT * FROM CUENTA

INSERT INTO PELICULA (ID_ESPECIFICO, TITULO, CATEGORIA)
VALUES	('5','LOS EGRESADOS','C. FICCION')

SELECT * FROM CUENTA

INSERT INTO VOLUMEN (NO_VOLUMEN, ID_ESPECIFICO, NOMBRE_PROVEEDOR)
VALUES	('008',NULL,'PELICULAS FUTURO')

SELECT * FROM CUENTA 

CREATE TRIGGER TR_TRES 
ON PROVEEDOR
FOR INSERT
AS
UPDATE CUENTA
SET NO_RENG_PROVEEDORES = (SELECT COUNT(NOMBRE_PROVEEDOR)FROM PROVEEDOR) 

CREATE TRIGGER TR_CUATRO
ON PROVEEDOR
FOR DELETE
AS
UPDATE CUENTA
SET NO_RENG_PROVEEDORES = (SELECT COUNT(NOMBRE_PROVEEDOR) FROM PROVEEDOR)

INSERT INTO PROVEEDOR
(NOMBRE_PROVEEDOR, TEL_PROVEEDOR)
VALUES	('PELICULAS SP',78)

SELECT * FROM CUENTA

DELETE FROM PROVEEDOR WHERE NOMBRE_PROVEEDOR = 'PELICULAS SP'
